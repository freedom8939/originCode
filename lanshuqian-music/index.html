<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lnnu在线音乐平台</title>
    <link rel="stylesheet" href="index.css">

</head>
<body>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js"></script>


<div class="container">

    <div class="header">
        <h1 class="logo">
            <img src="public/logo.png"/>
            <a>LNNU 音乐平台</a>
            <ul class="ul-table">
                <li><a href="../lanshuqian-music/components/FindNiceMusic/index.html">发现好音乐</a></li>
                <li><a href="../lanshuqian-music/components/MyMusicLib/index.html">我的乐库</a></li>
                <li><a href="../lanshuqian-music/components/Attention/index.html">关注</a></li>
                <li><a href="../lanshuqian-music/components/PublishMusic/index.html">推送歌曲</a></li>
                <li><a href="../lanshuqian-music/components/ReleaseNewMusic/index.html">新歌上架</a></li>
                <li><a href="../lanshuqian-music/components/TodaySinger/index.html">今日歌手</a></li>
                <li><a href="../lanshuqian-music/components/TodaySinger/index.html">今日歌手</a></li>
                <li><a href="../lanshuqian-music/components/TodaySinger/index.html">今日歌手</a></li>
                <li><a href="../lanshuqian-music/components/TodaySinger/index.html">今日歌手</a></li>
            </ul>

        </h1>
        <div class="search">
            <input class="searchBox" type="text" placeholder="寻找心中的声音">
        </div>
        <div class="searchButton" id="searchItem">
            <img class="searchImg" src="public/search.png" alt="">
        </div>
        <div class="login" id="loginButton">
            <span>登录</span>
        </div>
        <div class="welcome" style="display:none;">
            <div>
                <span>欢迎您, <span id="username"></span></span>
            </div>
            <button id="logoutButton">退出</button>

        </div>
    </div>
    <!--中间层-->
    <div class="center" id="content-main">
    </div>
    <!--中间层-->

    <div class="footer">
        <p>版权为 LNNU-202321020167-王金园. |
            <a href="#">仅供学习</a>
        <div>
            <a href="https://www.lnnu.edu.cn" target="_blank">辽宁师范大学</a>
        </div>
        </p>
    </div>

</div>
<script src="components/login/login.js"></script>
<!--//每次进入默认刷新-->
<script>
    if (true) {

        let userLoginState = Cookies.get('userLoginState');
        //本地有cookie
        if (userLoginState) {
            // 如果用户已登录
            let userInfo = JSON.parse(userLoginState);
            // 显示欢迎信息和用户名
            $('.welcome').show();
            $('#username').text(userInfo.userAccount);
            // 隐藏登录按钮
            $('#loginButton').hide();
        } else {
            // 如果用户未登录，显示登录按钮
            $('.welcome').hide();
            $('#loginButton').show();
        }
    }
    $(document).ready(function () {

        $.ajax({
            url: '../lanshuqian-music/components/FindNiceMusic/index.html',
            type: 'GET',
            success: function (response) {
                $('#content-main').html(response);
            },
            error: function (xhr, status, error) {
                console.error('Failed to load page:', error);
            }
        });

        $.ajax({
            url: 'http://localhost:8080/api/user/current',
            type: 'GET',
            xhrFields: {
                withCredentials: true // 允许发送 cookie
            },
            success: function (response) {
            },
            error: function (xhr, status, error) {

            }
        });

        $('#logoutButton').on('click', function () {
            Cookies.remove('userLoginState');

            $.ajax({
                url: 'http://localhost:8080/api/user/logout',
                type: 'POST',
                xhrFields: {
                    withCredentials: true
                },
                success: function (response) {
                    Cookies.remove('userLoginState');
                    $('.welcome').hide();
                    $('#loginButton').show();
                },
                error: function (xhr, status, error) {
                    console.error('Logout failed:', xhr.responseText);
                }
            });
        });

        $('a').on('click', function (e) {
            e.preventDefault();
            // 获取超链接的 href 属性值，即目标页面的路径
            var pageUrl = $(this).attr('href');
            $.ajax({
                url: pageUrl,
                type: 'GET',
                success: function (response) {
                    $('#content-main').html(response);
                },

            });
        });




    });
</script>
</body>
</html>
